# Day 2 å¼‚æ­¥ä¸äº‹ä»¶é©±åŠ¨æ ¸å¿ƒæ¦‚å¿µè§£æ

## ğŸ”„ åŒæ­¥ vs å¼‚æ­¥æ‰§è¡Œæ¨¡å¼

### åŒæ­¥æ‰§è¡Œ (Synchronous)
```python
# åŒæ­¥æ¨¡å¼ï¼šä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸€ä¸ªé˜»å¡ä¼šå½±å“åç»­ä»»åŠ¡
def process_tasks():
    task1 = long_running_task()  # è€—æ—¶5ç§’
    task2 = another_task()       # å¿…é¡»ç­‰å¾…task1å®Œæˆ
    return result
```

**ç‰¹ç‚¹**ï¼š
- âœ… ç®€å•ç›´è§‚ï¼Œæ˜“äºç†è§£
- âŒ é˜»å¡å¼æ‰§è¡Œï¼Œèµ„æºåˆ©ç”¨ç‡ä½
- âŒ ç”¨æˆ·ä½“éªŒå·®ï¼ˆé¡µé¢å¡æ­»ï¼‰

### å¼‚æ­¥æ‰§è¡Œ (Asynchronous)
```python
# å¼‚æ­¥æ¨¡å¼ï¼šä»»åŠ¡å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œä¸äº’ç›¸é˜»å¡
import asyncio

async def process_tasks():
    task1 = asyncio.create_task(long_running_task())  # ç«‹å³è¿”å›
    task2 = asyncio.create_task(another_task())        # ç«‹å³è¿”å›
    return await asyncio.gather(task1, task2)
```

**ç‰¹ç‚¹**ï¼š
- âœ… éé˜»å¡å¼ï¼Œé«˜å¹¶å‘å¤„ç†
- âœ… èµ„æºåˆ©ç”¨ç‡é«˜
- âŒ éœ€è¦é¢å¤–çš„çŠ¶æ€ç®¡ç†

## ğŸ“¨ Message Queue è®¾è®¡æ¨¡å¼

### Producer-Consumer æ¨¡å¼
```
[Producer] â†’ [Message Queue] â†’ [Consumer]

API Server    â†’     Redis     â†’   Celery Worker
   â†‘                â†“                â†“
å‘é€ä»»åŠ¡          å­˜å‚¨ä»»åŠ¡          å¤„ç†ä»»åŠ¡
```

**æ ¸å¿ƒç»„ä»¶**ï¼š
1. **Producer (ç”Ÿäº§è€…)**: APIæœåŠ¡å™¨ï¼Œåˆ›å»ºå¹¶å‘é€ä»»åŠ¡
2. **Message Queue (æ¶ˆæ¯é˜Ÿåˆ—)**: Redisï¼Œä¸´æ—¶å­˜å‚¨å¾…å¤„ç†ä»»åŠ¡
3. **Consumer (æ¶ˆè´¹è€…)**: Celery Workerï¼Œå®é™…æ‰§è¡Œä»»åŠ¡

### è§£å†³çš„é—®é¢˜
1. **å“åº”æ—¶é—´**: HTTPè¯·æ±‚ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…è€—æ—¶æ“ä½œ
2. **ç³»ç»Ÿç¨³å®šæ€§**: é¿å…é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡é˜»å¡æœåŠ¡å™¨
3. **å¯æ‰©å±•æ€§**: å¯ä»¥å¯åŠ¨å¤šä¸ªWorkerå¤„ç†ä»»åŠ¡
4. **å®¹é”™æ€§**: ä»»åŠ¡å¤±è´¥å¯ä»¥é‡è¯•ï¼Œä¸ä¼šä¸¢å¤±

## ğŸ¯ åœ¨AIä»»åŠ¡å¤„ç†ä¸­çš„åº”ç”¨

### ä¼ ç»ŸåŒæ­¥æ¨¡å¼çš„é—®é¢˜
```python
@app.post("/generate")
async def generate_text(prompt: str):
    # é—®é¢˜ï¼šOpenAI APIè°ƒç”¨å¯èƒ½éœ€è¦10-30ç§’
    result = await openai_client.generate(prompt)  # é˜»å¡ï¼
    return result  # ç”¨æˆ·éœ€è¦ç­‰å¾…å¾ˆä¹…
```

### å¼‚æ­¥é˜Ÿåˆ—æ¨¡å¼çš„ä¼˜åŠ¿
```python
@app.post("/generate")
async def generate_text(prompt: str):
    # ç«‹å³åˆ›å»ºä»»åŠ¡ï¼Œä¸ç­‰å¾…ç»“æœ
    task = process_ai_task.delay(prompt)
    return {"task_id": task.id, "status": "PENDING"}

# Celery Workeråœ¨åå°å¤„ç†
@celery_app.task
def process_ai_task(prompt):
    # åœ¨Workerä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
    result = openai_client.generate(prompt)
    return result
```

## ğŸ”„ äº‹ä»¶é©±åŠ¨æ¶æ„ä¼˜åŠ¿

### 1. è§£è€¦åˆ
- APIæœåŠ¡å™¨ä¸éœ€è¦çŸ¥é“AIå¤„ç†çš„å…·ä½“å®ç°
- AIå¤„ç†é€»è¾‘å¯ä»¥ç‹¬ç«‹æ›´æ–°å’Œæ‰©å±•

### 2. å¯æ‰©å±•
- å¯ä»¥æ ¹æ®è´Ÿè½½åŠ¨æ€å¢å‡Workeræ•°é‡
- ä¸åŒç±»å‹çš„ä»»åŠ¡å¯ä»¥æœ‰ä¸åŒçš„Worker

### 3. å®¹é”™æ€§
- Workerå´©æºƒä¸ä¼šå½±å“APIæœåŠ¡å™¨
- ä»»åŠ¡å¤±è´¥å¯ä»¥è‡ªåŠ¨é‡è¯•

### 4. ç›‘æ§å’Œç®¡ç†
- å¯ä»¥ç›‘æ§ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦
- å¯ä»¥æŸ¥çœ‹ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å’Œè€—æ—¶

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | åŒæ­¥æ¨¡å¼ | å¼‚æ­¥é˜Ÿåˆ—æ¨¡å¼ |
|------|----------|-------------|
| å“åº”æ—¶é—´ | 10-30ç§’ | <100æ¯«ç§’ |
| å¹¶å‘å¤„ç†èƒ½åŠ› | å—é™äºæœåŠ¡å™¨è¿æ¥æ•° | ç†è®ºä¸Šæ— é™åˆ¶ |
| ç³»ç»Ÿç¨³å®šæ€§ | å®¹æ˜“è¶…æ—¶å´©æºƒ | é«˜ç¨³å®šæ€§ |
| èµ„æºåˆ©ç”¨ç‡ | ä½ï¼ˆå¤§éƒ¨åˆ†æ—¶é—´ç­‰å¾…ï¼‰ | é«˜ï¼ˆæŒç»­å¤„ç†ï¼‰ |
| ç”¨æˆ·ä½“éªŒ | å·®ï¼ˆéœ€è¦ç­‰å¾…ï¼‰ | ä¼˜ï¼ˆç«‹å³åé¦ˆï¼‰ |

## ğŸª å®é™…åº”ç”¨åœºæ™¯

### é€‚ç”¨åœºæ™¯
- âœ… AIæ–‡æœ¬ç”Ÿæˆå’Œå›¾åƒå¤„ç†
- âœ… é‚®ä»¶å‘é€å’Œé€šçŸ¥æ¨é€
- âœ… æ•°æ®å¤„ç†å’ŒæŠ¥è¡¨ç”Ÿæˆ
- âœ… æ–‡ä»¶ä¸Šä¼ å’Œè½¬ç 
- âœ… ç¬¬ä¸‰æ–¹APIè°ƒç”¨

### ä¸é€‚ç”¨åœºæ™¯
- âŒ éœ€è¦ç«‹å³è¿”å›ç»“æœçš„ç®€å•æŸ¥è¯¢
- âŒ æ‰§è¡Œæ—¶é—´<100msçš„å¿«é€Ÿæ“ä½œ
- âŒ å®æ—¶æ€§è¦æ±‚æé«˜çš„æ“ä½œ